<template>
  <div id="bcg-wrapper">
    <transition
      @enter="enter"
      @leave="leave"
      @after-enter="animate()"
      mode="out-in"
      :css="false"
    >
      <svg
        v-if="ratioIsPortrait"
        id="b5a88778-fe98-4a92-a77d-6e1219c31d2e"
        data-name="Layer 1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        x="0"
        y="0"
        viewBox="0 0 760 1177"
        :key="ratioIsPortrait"
      >
        <defs>
          <linearGradient
            id="bdc3a7a5-0bb1-4256-8608-d504d6206cd9"
            data-name="New Gradient Swatch 2"
            x1="374.5"
            y1="-19.87"
            x2="374.5"
            y2="1085.64"
            gradientUnits="userSpaceOnUse"
          >
            <stop offset="0" class="color0" stop-opacity="0" />
            <stop offset="0.07" class="color1" />
            <stop offset="1" class="color2" />
          </linearGradient>
          <linearGradient
            id="b4e3d593-8d1f-4141-9a36-648b0669002c"
            x1="376.78"
            y1="-19.87"
            x2="376.78"
            y2="1085.64"
            xlink:href="#bdc3a7a5-0bb1-4256-8608-d504d6206cd9"
          />
          <linearGradient
            id="f082f8a7-fbd2-44db-9d70-ed60ceff4a6b"
            x1="376.78"
            y1="627.02"
            x2="376.78"
            y2="-1338.91"
            xlink:href="#bdc3a7a5-0bb1-4256-8608-d504d6206cd9"
          />
          <linearGradient
            id="b5ce5d34-1567-481c-9f75-a41d217ef23d"
            x1="374.5"
            y1="627.02"
            x2="374.5"
            y2="-1338.91"
            xlink:href="#bdc3a7a5-0bb1-4256-8608-d504d6206cd9"
          />
          <linearGradient
            id="f92cddc3-3f61-41d7-9e10-609884b8869e"
            x1="697.4"
            y1="827.58"
            x2="-43.96"
            y2="86.21"
            xlink:href="#bdc3a7a5-0bb1-4256-8608-d504d6206cd9"
          />
          <linearGradient
            id="a1dd445e-aa95-489f-bc5c-c96f94f6570a"
            x1="297.64"
            y1="988.36"
            x2="297.64"
            y2="-147.64"
            gradientTransform="translate(645.37 252.46) rotate(46.45)"
            xlink:href="#bdc3a7a5-0bb1-4256-8608-d504d6206cd9"
          />
          <linearGradient
            id="e8b48ca8-1e24-4876-923f-3d8f360225e3"
            x1="217.06"
            y1="988.36"
            x2="217.06"
            y2="-147.64"
            gradientTransform="translate(645.37 252.46) rotate(46.45)"
            xlink:href="#bdc3a7a5-0bb1-4256-8608-d504d6206cd9"
          />
        </defs>
        <g>
          <g id="ellipse_upper" data-name="elipsa">
            <path
              d="M-6-2V186.77q21.32,1.92,43.08,3.63,49.74,3.9,101.71,6.64a483.11,483.11,0,0,1,476-.82q53.16-3,104-7.22,18.25-1.51,36.18-3.19V-2Z"
              transform="translate(6 2)"
              fill="url(#bdc3a7a5-0bb1-4256-8608-d504d6206cd9)"
            />
            <path
              d="M138.79,197c74.07,3.9,151.21,6,230.47,6,84.64,0,166.87-2.35,245.52-6.78a483.11,483.11,0,0,0-476,.82Z"
              transform="translate(6 2)"
              fill="url(#b4e3d593-8d1f-4141-9a36-648b0669002c)"
            />
          </g>
          <g id="circle_left" data-name="koloP">
            <path
              d="M520,560.36a151.73,151.73,0,0,0-54.71,249.57A151.69,151.69,0,1,0,520,560.36Z"
              transform="translate(6 2)"
              fill="none"
            />
            <path
              d="M614.78,196.22a483.11,483.11,0,0,0-476,.82c74.07,3.9,151.21,6,230.47,6C453.9,203,536.13,200.65,614.78,196.22Z"
              transform="translate(6 2)"
              fill="url(#f082f8a7-fbd2-44db-9d70-ed60ceff4a6b)"
            />
            <path
              d="M614.78,196.22C536.13,200.65,453.9,203,369.26,203c-79.26,0-156.4-2.06-230.47-6A484.83,484.83,0,0,0-6,323.61V719.68A198.38,198.38,0,0,1,19.12,816.6,198.32,198.32,0,0,1-4.64,911q13,16.85,27.44,32.46a229.12,229.12,0,0,1,29.48-34.16c91.26-86.76,235.57-83.12,322.34,8.14A228.07,228.07,0,0,1,415.49,977H698.13A485.57,485.57,0,0,0,755,917v-601A484.87,484.87,0,0,0,614.78,196.22Zm65,613.71a151.7,151.7,0,1,1,0-214.51A151.7,151.7,0,0,1,679.76,809.93Z"
              transform="translate(6 2)"
              fill="url(#b5ce5d34-1567-481c-9f75-a41d217ef23d)"
            />
          </g>
          <path
            id="circle_central"
            data-name="koloC"
            d="M478.65,821.84a151.68,151.68,0,1,0-13.41-11.91A151.7,151.7,0,0,0,478.65,821.84Z"
            transform="translate(6 2)"
            fill="url(#f92cddc3-3f61-41d7-9e10-609884b8869e)"
          />
          <g id="circle_right" data-name="koloR">
            <path
              d="M421.82,991.68q-2.9-7.42-6.33-14.68H56.87Q39,961.1,22.8,943.5A226.29,226.29,0,0,0-6,999.64v114.72l175.63,184.73a227.72,227.72,0,0,0,196.84-59.27C435.6,1174.1,454.44,1075.37,421.82,991.68Z"
              transform="translate(6 2)"
              fill="url(#a1dd445e-aa95-489f-bc5c-c96f94f6570a)"
            />
            <path
              d="M56.87,977H415.49a228.07,228.07,0,0,0-40.87-59.52c-86.77-91.26-231.08-94.9-322.34-8.14A229.12,229.12,0,0,0,22.8,943.5Q39,961.07,56.87,977Z"
              transform="translate(6 2)"
              fill="url(#e8b48ca8-1e24-4876-923f-3d8f360225e3)"
            />
          </g>
        </g>
      </svg>

      <svg
        v-else
        id="bcg-svg"
        data-name="Layer 1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        x="0"
        y="0"
        viewBox="0 0 1900 1000"
        :key="ratioIsPortrait"
      >
        <defs>
          <linearGradient
            id="bd943ecc-f758-4848-867d-32a1e6021a31"
            x1="959.5"
            y1="122.41"
            x2="959.5"
            y2="1298.46"
            gradientUnits="userSpaceOnUse"
          >
            <stop offset="0" class="color0" stop-opacity="0" />
            <stop class="color1" offset="0.07" />
            <stop class="color2" offset="1" />
          </linearGradient>
          <linearGradient
            id="a76479e8-94e3-41fe-b879-8f8db571de14"
            x1="1803.24"
            y1="972.42"
            x2="564.23"
            y2="-266.59"
            gradientUnits="userSpaceOnUse"
          >
            <stop class="color0" offset="0" stop-opacity="0" />
            <stop class="color1" offset="0.07" />
            <stop class="color2" offset="1" />
          </linearGradient>
          <linearGradient
            id="b4a10aea-9592-4906-9979-e7c5e7d99ba8"
            x1="972.5"
            y1="677.6"
            x2="972.5"
            y2="-1571.5"
            gradientUnits="userSpaceOnUse"
          >
            <stop class="color0" offset="0" stop-opacity="0" />
            <stop class="color1" offset="0.07" />
            <stop class="color2" offset="0.91" />
          </linearGradient>
          <linearGradient
            id="b762dba1-8438-4a2d-94de-925cc917c992"
            x1="334.5"
            y1="1000.42"
            x2="334.5"
            y2="-135.58"
            gradientUnits="userSpaceOnUse"
          >
            <stop class="color0" offset="0" stop-opacity="0" />
            <stop class="color1" offset="0.08" />
            <stop class="color2" offset="1" />
          </linearGradient>
        </defs>
        <g>
          <g id="ellipse_upper">
            <path
              d="M1,1V285.69c144.55,26.94,322.38,47.83,521.24,60.4,137.41,8.69,284.83,13.41,438.26,13.41,162,0,317.31-5.26,461.19-14.9C1610.39,332,1779.4,311.79,1918,286.06V1Z"
              transform="translate(-1 -1)"
              fill="url(#bd943ecc-f758-4848-867d-32a1e6021a31)"
            />
          </g>

          <path
            id="circle_central"
            d="M1506.67,525.83a549.68,549.68,0,0,0-85-181.23c-100.14-139.91-264-231.1-449.19-231.1-185.84,0-350.22,91.83-450.26,232.59A549.49,549.49,0,0,0,420.5,665.5q0,9,.3,17.92c83.13,34,141.7,115.7,141.7,211.08a227.07,227.07,0,0,1-27.18,108A554.92,554.92,0,0,0,605.69,1078h733.62a552.88,552.88,0,0,0,167.36-552.17Z"
            transform="translate(-1 -1)"
            fill="url(#b4a10aea-9592-4906-9979-e7c5e7d99ba8)"
          />

          <path
            id="circle_right"
            d="M1773.75,584.42c-72.21-72.21-177.16-91.73-267.08-58.59a252.51,252.51,0,0,0-91.42,58.59c-99,99-99,259.51,0,358.51a256.55,256.55,0,0,0,22.41,19.91c99.49,78.55,244.25,71.92,336.09-19.91C1872.75,843.93,1872.75,683.42,1773.75,584.42Z"
            transform="translate(-1 -1)"
            fill="url(#a76479e8-94e3-41fe-b879-8f8db571de14)"
          />

          <path
            id="circle_left"
            d="M420.8,683.42a227.24,227.24,0,0,0-86.3-16.92c-125.92,0-228,102.08-228,228A227.66,227.66,0,0,0,199.17,1078H469.83A227.71,227.71,0,0,0,562.5,894.5C562.5,799.12,503.93,717.44,420.8,683.42Z"
            transform="translate(-1 -1)"
            fill="url(#b762dba1-8438-4a2d-94de-925cc917c992)"
          />
        </g>
      </svg>
    </transition>
  </div>
</template>

<script>
import gsap from "gsap";
export default {
  name: "Background",
  props: {
    height: { type: Number },
    dark: { type: Boolean },
  },
  data() {
    return {
      backgroundTween: new gsap.timeline({ paused: true }),
      layoutAnimation: new gsap.timeline({ paused: true }),
      windowWidth: window.innerWidth,
      windowHeight: window.innerHeight,
    };
  },

  computed: {
    viewBoxHeight: function() {
      return this.height + 1000;
    },

    viewBoxHeightPortrait: function() {
      return this.height + 1000;
    },

    viewBoxReactive: function() {
      if (this.windowWidth < this.windowHeight && this.height < 800)
        return `0 0 1900 ${this.viewBoxHeight}`;
      else return `0 0 1900 1000`;
    },

    viewBoxReactivePortrait: function() {
      if (this.windowWidth < this.windowHeight && this.height < 700)
        return `0 0 760 ${this.viewBoxHeightPortrait}`;
      else return `0 0 760 1177`;
    },

    ratioIsPortrait: function() {
      return this.windowWidth < this.windowHeight;
    },
  },

  methods: {
    animate: function() {
      this.layoutAnimation.fromTo(
        "#circle_right",
        10,
        { scale: 1, x: 0 },
        {
          scale: 1.2,
          x: 100,
          repeat: -1,
          repeatDelay: 0,
          ease: "sine.inOut",
          yoyo: true,
          transformOrigin: "center center",
          immediateRender: true,
        }
      );
      this.layoutAnimation.fromTo(
        "#circle_left",
        6,
        { scale: 1, x: 0 },
        {
          scale: 1.5,
          x: -100,
          repeat: -1,
          repeatDelay: 0,
          ease: "sine.inOut",
          yoyo: true,
          transformOrigin: "center center",
          immediateRender: true,
        }
      );

      this.layoutAnimation.fromTo(
        "#ellipse_upper",
        15,
        { scale: 1 },
        {
          scale: 1.2,
          repeat: -1,
          repeatDelay: 0,
          ease: "expo.inOut",
          yoyo: true,
          transformOrigin: "center center",
          immediateRender: true,
        }
      );

      this.layoutAnimation.fromTo(
        "#circle_central",
        10,
        { scale: 1 },
        {
          scale: 1.1,
          repeat: -1,
          repeatDelay: 0,
          ease: "expo.inOut",
          yoyo: true,
          transformOrigin: "center center",
          immediateRender: true,
        }
      );

      this.layoutAnimation.play();
      console.log("background animation");
    },

    enter(el, done) {
      gsap.fromTo(
        el,
        { opacity: 0, scale: 0 },
        {
          opacity: 1,
          scale: 1,
          duration: 0.7,
          ease: "back.inOut(3)",

          onComplete: done,
        }
      );
    },

    leave(el, done) {
      gsap.fromTo(
        el,
        { opacity: 1, scale: 1 },
        {
          opacity: 0,
          scale: 0,
          duration: 0.7,
          ease: "back.inOut(3)",
          onComplete: done,
        }
      );
    },
  },

  watch: {
    dark: function(newVal, oldVal) {
      if (newVal === true || oldVal === false) {
        // this.backgroundTween.play();

        console.log("this is dark");
      } else {
        // this.backgroundTween.reverse(0).play();
        console.log("this is light");
      }
      // this.backgroundTween.reversed(!this.backgroundTween.reversed());
      console.log("Prop changed: ", newVal, " | was: ", oldVal, "animation");
    },
  },

  mounted() {
    this.animate();

    window.onresize = () => {
      this.windowWidth = window.innerWidth;
      this.windowHeight = window.innerHeight;
      if (this.windowWidth / this.windowHeight < 1) {
        console.log("ratio < 1");
      } else if (this.windowWidth / this.windowHeight === 1)
        console.log("component updated");
      else console.log("ratio > 1");
    };
  },
};
</script>

<style scoped lang="scss">
#bcg-wrapper {
  position: absolute;
  top: 0;
  z-index: 0;
  width: 100vw;
  min-height: 100vh;
}

svg {
  overflow: visible;
  width: 100%;
}

//background
.color0 {
  stop-color: var(--bg-primary);
}

.color1 {
  stop-color: var(--bg-primary);
}

//accent
.color2 {
  stop-color: var(--text-primary);
}
</style>
